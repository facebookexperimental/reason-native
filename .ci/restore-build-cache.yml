steps:
  - task: DownloadBuildArtifacts@0
    condition: and(succeeded(), ne(variables['Build.SourceBranch'], 'refs/heads/master'))
    displayName: 'Cache: Restore install'
    inputs:
        buildType: 'specific'
        project: '$(System.TeamProject)'
        pipeline: '$(Build.DefinitionName)'
        branchName: 'refs/heads/master'
        buildVersionToDownload: 'latestFromBranch'
        downloadType: 'single'
        artifactName: 'cache-$(Agent.OS)-install'
        downloadPath: '$(Build.ArtifactStagingDirectory)'
    continueOnError: true

  - bash: 'tar -xf npm-cache.tar -C $(NPM__GLOBAL_ROOT) && tar -xf esy-cache.tar -C $(ESY__CACHE_INSTALL_PATH) && cd .. && rm -rf cache-$(Agent.OS)-install'
    continueOnError: true
    workingDirectory: '$(Build.ArtifactStagingDirectory)/cache-$(Agent.OS)-install'
    condition: and(succeeded(), ne(variables['Build.SourceBranch'], 'refs/heads/master'))
    displayName: 'Untar cache directory'
